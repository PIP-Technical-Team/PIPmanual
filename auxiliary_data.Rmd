# Auxiliary data

```{r, echo=FALSE, include=FALSE}
library(data.table)
library(pipaux)
```

As it was said in Section \@ref(data-acquisition), auxiliary data is the data
used to temporally deflate and line up welfare data, with the objective of
getting poverty estimates comparable over time, across countries, and, more
importantly, being able to estimate regional and global estimates. Yet,
auxiliary data also refers to metadata with functional and qualitative
information. Functional information is such that is used in internal
calculations such as time comparability or surveys availability. Qualitative
information is just useful information that does not affect, neither depend on,
quantitative data. It is primary collected and made available for the end user.

As explain in Chapter \@ref(folder-structure), all auxiliary data is stored in
`"y:/PIP-Data/_aux/"`.

```{r aux-dir, echo=FALSE}
fs::dir_tree("y:/PIP-Data/_aux/", 
             recurse = FALSE, 
             regex = ".*(?<!\\.txt)$", 
             perl = TRUE)
```

The naming convention of subfolders inside the \_aux directory is useful because
auxiliary data is commonly referred to in all technical processes by its
convention rather than by it actual name. For instance Gross Domestic Product or
Purchasing Power Parity are better known as gdp and ppp, respectively. Yet,
other measures such as national population or consumption also make use of
conventions.

In this chapter you will learn everything related to each of the files that
store auxiliary data. Notice that the chapter is structured by files rather than
by measures or types of auxiliary data because you may find more than one
measure in one file.

The R package that manages auxiliary data is `{pipaux}`.

As explained in Chapter \@ref(folder-structure), within the folder of each
auxiliary file, you will find, at a minimum, a `_vintage` folder, one `xxx.fst`,
one `xxx.dta` file, and one `xxx_datasignature.txt` , where `xxx` stands for the
name of the file.

## Population

### Original data

Everything related to population data should be placed in the folder
`y:\PIP-Data\_aux\pop\`. hereafter (`./`).

The population data come from one of two different sources. WDI or an internal
file provided by a member of the DECDG team. Ideally, population data should be
downloaded from WDI, but sometimes the most recent data available has not been
uploaded yet, so it needs to be collected internally in DECDG. As of now
(`r format(Sys.time(), "%B %d, %Y")`), the DECDG focal point to provide the
population data is [Emi Suzuki](mailto:esuzuki1@worldbank.org). You just need to
send her an email, and she will provide the data to you.

If the data is provided by DECDG, it should be stored in the folder
`./raw_data`. The original excel file must be placed without modification in the
folder `./raw_data/original`. Then, the file is copied again one level up into
the folder `./raw_data` with the name `population_country_yyyy-mm-dd.xlsx` where
`yyyy-mm-dd` refers to the official release date of the population data. Notice
that for countries PSE, KWT and SXM, some years of population data are missing
in the DECDG main file and hence in WDI. Here we complement the main file with
an additional file shared by Emi to assure complete coverage. This file contains
historical data and will not need to be updated every year. This additional file
has the name convention `population_missing_yyyy-mm-dd.xlsx` and should follow
the same process as the `population_country` file. Once all the files and their
corresponding place, you can update the `./pop.fst` file by typing
`pipaux::pip_pop_update(src = "decdg")`.

If the data comes directly from WDI, you just need to update the file
`./pop.fst` by typing `pipaux::pip_pop_update(src = "wdi")`. It is worth
mentioning that the population codes used in WDI are "SP.POP.TOTL",
"SP.RUR.TOTL", and "SP.URB.TOTL", which are total population, rural population,
and urban population, respectively. If it is the case that PIP begins using
subnational population, a new set of WDI codes should be added to the R script
in
[pipaux::pip_pop_update()](https://github.com/PIP-Technical-Team/pipaux/blob/cd7738f98ec5373db8333c3573700b4991776c8d/R/pip_pop_update.R#L17).

### Data structure

Population data is loaded by typing either `pipload::pip_load_aux("pop")` or
`pipaux::pip_pop("load")`. We highly recommend the former, as `{pipload}` is the
intended R package for loading any PIP data.

```{r}
pop <- pipload::pip_load_aux("pop")
head(pop)
```

## National Accounts

National accounts account for the economic development of a country at an
aggregate or macroeconomic level. These measure are thus useful to interpolate
or extrapolate microeconomic measures mean welfare aggregate or poverty
headcount when household surveys are not available. National accounts work as a
proxy of the economic development that would have been present if household
surveys were available.

There are two main types of national accounts, Household Final Consumption
Expenditure (HFCE) and Gross Domestic Product (GDP)---both in real per capita
terms. Please refer to [Section
5.3](https://povcalnet-team.github.io/Methodology/lineupestimates.html#nationalaccounts)
of [@worldbankPovertyInequalityPlatform2021] to understand the usage of national
accounts data.

### GDP

As explained in [Section
5.3](https://povcalnet-team.github.io/Methodology/lineupestimates.html#nationalaccounts)
of [@worldbankPovertyInequalityPlatform2021], there are three sources of GDP
data, and one more for a few particular cases. The integration of all the
sources of GDP data is performed by `pipaux::pip_gdp_update()`, you'll need to
manually download and store the data from WEO and the data for the special
cases.

The most recent version of the WEO data most be downloaded from the [World
Economic Outlook
Databases](https://www.imf.org/en/Publications/SPROLLS/world-economic-outlook-databases)
of the IMF.org website and saved as an .xls file in `<maindir>/_aux/weo/`. The
filename should be in the following structure `WEO_<YYYY-DD-MM>.xls`. Due to
potential file corruption the file must be opened and re-saved before it can be
updated with `pip_gdp_weo()`, which is an internal function fo
`pipaux::pip_gdp_update()`. Hopefully in the future IMF will stop using an
\`.xls\` file that's not really xls.

[Note: explanation of special cases provided by Samuel.]{style="color:red"}

### Consumption (PCE)

Private Consumption Expenditure (pce) is gathered from WDI, with the exception
of a few special cases. As in the case of GDP, the special cases are treated in
the same way with PCE. You only need to execute the function
`pipaux::pip_pce_update()` to update the PCE data.

## CPI

### Raw data

[Note: Minh to explain how the CPI data is collected and organized in the dlw
folders.]{style="color:red"}

### Vintage control

```{r, echo=FALSE, include=FALSE}
cpi <- pipload::pip_load_aux("cpi")
cpi_id <- cpi[, 
              unique(cpi_id)]
```

Vintage control of the CPI data comes in a similar fashion as welfare data,
`CPI_vXX_M_vXX_A`, where `vXX_M` refers to the version of the master or raw
data, and `vXX_A` refers to the alternative version.

Every year, around November-December, PIP CPI data is updated with the most
recent version of the IMF CPI data, which comes with information for the most
recent year available and with changes/fixes/additions of previous years for
each country. When this happens, the master version of the CPI ID is increased
in one unit before the data is saved. As of today, the current ID is `r cpi_id`.
If data is modified during the rolling of the year, then the alternative version
of the CPI ID is increased in one unit.

### Data structure 

When you load CPI data using `pipload::pip_load_aux("cpi")`, the data you get
has already been cleaned for being use in the PIP workflow, and it is slightly
different from the original CPI data stored in datalibweb servers. That is, the
way CPI data is used and referred to datalibweb is different from the way it is
used in PIP even though they both achive the same purpose.

The most important variable in CPI data is, no surprisingly, `cpi`. This
variable however, is not available in the original CPI data from dlw. The
original name of this variable comes in the form `cpiYYYY`, where `YYYY` refers
to the base year of the CPI, which in turn depends on the collection year of the
PPP. Today, this variable is thus "`r getOption("pipaux.cpivar")`." The name of
this variable is stored in the `pipaux.cpivar` object in the `zzz.R` file of the
`{pipaux}` package. This will supdate the option `getOption("pipaux.cpivar")`,
guaranteing that `pipaux::pip_cpi_update()` uses the right variable when
updating the CPI data.

Another variable

## PPP

[Note: Minh to explain how the PPP data is collected and organized in the dlw
folders.]{style="color:red"}

PPP data is organized... s

### Original data

blah

## Price FrameWork (PFW)

blah

### Original data
