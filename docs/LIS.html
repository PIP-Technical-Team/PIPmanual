<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PIP Manual - 9&nbsp; LIS Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./welfare_data.html" rel="next">
<link href="./PRIMUS.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./price_framework.html">PIP data</a></li><li class="breadcrumb-item"><a href="./LIS.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">LIS Data</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PIP Manual</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/PIP-Technical-Team/PIPmanual" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Welcome</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About PIP</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The GPID Team</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./welcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">For New Members</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Technical requirements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./internal_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Internal Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Folder_structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Folder Structure</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joining_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Joining Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">PIP data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./price_framework.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Price FrameWork (pfw) data frame</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PRIMUS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">PRIMUS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LIS.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">LIS Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./welfare_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Welfare data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./auxiliary_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Auxiliary data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">PIP Procedures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pc_pipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Poverty Calculator Pipeline (pre-computed estimations)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tm_pipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Table Maker Pipeline</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Standalone Technical Considerations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./load_md_aux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Load microdata and Auxiliary data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Docker Container</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./azure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Deploying to Azure</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Github Workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./subtrees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Subtrees using Smartgit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-lis_data-repository" id="toc-the-lis_data-repository" class="nav-link active" data-scroll-target="#the-lis_data-repository"><span class="header-section-number">9.1</span> The LIS_data repository</a></li>
  <li><a href="#interacting-with-lissy" id="toc-interacting-with-lissy" class="nav-link" data-scroll-target="#interacting-with-lissy"><span class="header-section-number">9.2</span> Interacting with LISSY</a></li>
  <li><a href="#getting-the-400-bins-from-lissy" id="toc-getting-the-400-bins-from-lissy" class="nav-link" data-scroll-target="#getting-the-400-bins-from-lissy"><span class="header-section-number">9.3</span> Getting the 400 bins from LISSY</a></li>
  <li><a href="#from-text-file-to-datalibweb-structure" id="toc-from-text-file-to-datalibweb-structure" class="nav-link" data-scroll-target="#from-text-file-to-datalibweb-structure"><span class="header-section-number">9.4</span> From Text file to datalibweb structure</a>
  <ul class="collapse">
  <li><a href="#get-rcall-working-in-your-computer" id="toc-get-rcall-working-in-your-computer" class="nav-link" data-scroll-target="#get-rcall-working-in-your-computer">1. Get <code>rcall</code> working in your computer</a></li>
  <li><a href="#personal-drive" id="toc-personal-drive" class="nav-link" data-scroll-target="#personal-drive">2. Personal Drive</a></li>
  <li><a href="#directives-of-the-code" id="toc-directives-of-the-code" class="nav-link" data-scroll-target="#directives-of-the-code">3. Directives of the code</a></li>
  <li><a href="#pattern-of-the-text-files" id="toc-pattern-of-the-text-files" class="nav-link" data-scroll-target="#pattern-of-the-text-files">4. Pattern of the text files</a></li>
  <li><a href="#output" id="toc-output" class="nav-link" data-scroll-target="#output">5. Output</a></li>
  </ul></li>
  <li><a href="#compare-new-lis-data-to-datalibweb-inventory" id="toc-compare-new-lis-data-to-datalibweb-inventory" class="nav-link" data-scroll-target="#compare-new-lis-data-to-datalibweb-inventory"><span class="header-section-number">9.5</span> Compare new LIS data to Datalibweb inventory</a></li>
  <li><a href="#the-excel-file-lis-datasets.xlsx" id="toc-the-excel-file-lis-datasets.xlsx" class="nav-link" data-scroll-target="#the-excel-file-lis-datasets.xlsx"><span class="header-section-number">9.6</span> The Excel file <code>LIS datasets.xlsx</code></a></li>
  <li><a href="#prepare-data-for-the-poverty-gp" id="toc-prepare-data-for-the-poverty-gp" class="nav-link" data-scroll-target="#prepare-data-for-the-poverty-gp"><span class="header-section-number">9.7</span> Prepare data for the Poverty GP</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-lis" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">LIS Data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Some of the countries that are not available in DataLibWeb can be found in the repository of the <a href="https://www.lisdatacenter.org/">LIS Cross-National Data Center</a> (hereafter, LIS). Currently, PovcalNet uses LIS data for 9 high-income economies: AUS, CAN, DEU, ISR, JPN, KOR, TWN, GBR &amp; USA, plus the Pre-EUSILC years (generally before 2002) of European Economies.</p>
<p>LIS datasets cannot be downloaded in full; however, they provide a remote-execution system, <a href="http://www.lisdatacenter.org/data-access/lissy/">LISSY,</a> that allows us interact with their microdata without having access to the individual records. We have developed a set of Stata do-files to interact with LISSY and aggregate the welfare distribution of our countries of interest to 400 bins. Then, these data is organized locally and shared with the Poverty GP to be included in DataLibWeb as a collection independent from GPWG.</p>
<section id="the-lis_data-repository" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="the-lis_data-repository"><span class="header-section-number">9.1</span> The LIS_data repository</h2>
<p>In order to work with the LIS data you need to clone the repository <a href="https://github.com/GPID-WB/LIS_data">GPID-WB/LIS_data</a> You will find in there three folders, <em>00.LIS_output</em>, <em>01.programs</em>, and <em>02.data</em>.</p>
</section>
<section id="interacting-with-lissy" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="interacting-with-lissy"><span class="header-section-number">9.2</span> Interacting with LISSY</h2>
<p><strong>Opening an account in LISSY:</strong></p>
<p>To interact with the LIS data you need to first register <a href="http://www.lisdatacenter.org/lis-luli-frontend-webapp/app/request-account-identification"><strong>here</strong></a>, by first completing the <a href="http://www.lisdatacenter.org/wp-content/uploads/our-microdata-user-registration-form.pdf">LIS microdata User Registration Form</a>, and then submitting it through the same website using your <strong>institutional e-mail</strong> account. Within a couple of days, you will receive an e-mail from LIS containing your username and password.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>You do not get to choose your own username or password. LISdatacenter creates both for you and those won’t change in time. Make sure to save that e-mail and record that information for your future log-ins. Also, know that LISSY passwords expire each year on December 31st. While your password won’t change, it must be <strong>renewed</strong><a href="http://www.lisdatacenter.org/lis-luli-frontend-webapp/app/request-renew-identification">here</a> after January 1st.</em></p>
</div>
</div>
<p><strong>Interacting with LISSY:</strong></p>
<p>To get acquainted with LISSY’s interface, coding structure, database naming and variables available, and learn how to compute estimates within LISSY we highly recommend taking some time to review the <a href="https://www.lisdatacenter.org/resources/"><strong>tutorials</strong></a> and <a href="https://www.lisdatacenter.org/resources/self-teaching/"><strong>self-teaching materials</strong></a>. However, in order to update the 400 bins twice a year, Stata codes have been previously written, so you simply need to follow the 5 steps in the next section.</p>
</section>
<section id="getting-the-400-bins-from-lissy" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="getting-the-400-bins-from-lissy"><span class="header-section-number">9.3</span> Getting the 400 bins from LISSY</h2>
<p><strong>1.</strong> To log in, go to <a href="https://www.lisdatacenter.org/">LIS main page</a>, scroll down and click on the lock icon <img src="img/LIS_login.jpg" class="img-fluid" width="79"></p>
<p><strong>2.</strong> Feed the three drop-down menus on top of the platform with the following information:</p>
<ul>
<li><p>Project: <strong>LIS</strong></p></li>
<li><p>Package: <strong>Stata</strong></p></li>
<li><p>Subject: (<em>Choose a name</em> Ex: “<strong>Bins #1 - Dec 2020</strong>”)</p></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>The LISSY platform cannot run the code for ALL surveys available at once. If you attempt to do so, your project will stop and you will receive an e-mail containing the text:</p>
<pre><code>#####################################################
  Your job has been killed and will be not executed  
#####################################################</code></pre>
<p>To avoid this, we need to run the code in groups of no more than <strong>55</strong> data-points (years), depending on the amount of years in each of country. Currently, LIS has data for almost 900 data points for <u>53 countries</u> (26 of them are in the EUSILC project, and 26 do not). To divide the total surveys into groups of no more than 55, go to [METIS](<a href="https://www.lisdatacenter.org/frontend#/home" class="uri">https://www.lisdatacenter.org/frontend#/home</a>) and download the total report in:</p>
<p><img src="img/LIS_export.jpg" width="486" height="55"></p>
<p>This process usually take approximately <u>17 rounds</u> in order to download them all.</p>
</div>
</div>
<p><strong>3.</strong> <strong>Copy and paste</strong> the entire content of <code>01.LIS_400bins.do</code> file into the the main large command window and update the locals in lines 23-24 with the LIS 2-letter acronyms of a small group of countries (of no more than 55 total years) in each round:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> silc   <span class="st">"at be cz"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nosilc <span class="st">"au br"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember to update the subject with each round (Ex: “Bins #2 - Dec 2024”) so you keep track of the number of output files. Be careful not to leave out [or repeat] any country in the process.</p>
</div>
</div>
<p><strong>4</strong>. Click on the green arrow icon <img src="img/LIS_submit_job.jpg" width="29" height="26"> to submit your project. You will get an e-mail within some minutes with your output. If the system kills your project, your group of countries was probably too large. Remove one country and try again.</p>
<p><strong>5.</strong> Copy the entire text in the output e-mail you receive for each round, open your notepad and paste. Save each round in the <strong><em>\00.LIS_output</em></strong> folder. Save each text file with the name <strong>LISSY_Dec202@_#.txt</strong>, [where @ is the year and # the round]. Consistency with this naming format is important for the next step (<code>02.LIS_organize_output.do</code> file)</p>
</section>
<section id="from-text-file-to-datalibweb-structure" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="from-text-file-to-datalibweb-structure"><span class="header-section-number">9.4</span> From Text file to datalibweb structure</h2>
<p>We now need to convert the the text files generated by the LISSY system to actual data suitable for datalibweb. This structure is suggested by the <a href="https://ihsn.org/">International Household Survey Network</a> (IHSN). Once the data is saved in folder <code>00.LIS_output</code> you need to execute the file <strong><code>02.LIS_organize_output.do</code></strong>. This file created to be executed in just one go. However, it could be ran in sections taking advantage of the different <a href="https://www.stata.com/new-in-stata/multiple-datasets-in-memory/">frames</a> along the code.</p>
<p>Before you execute this code, you need to ensure a few things,</p>
<section id="get-rcall-working-in-your-computer" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="get-rcall-working-in-your-computer">1. Get <code>rcall</code> working in your computer</h3>
<p>The processing of the text files is not done anymore on Stata but in R. To avoid changing systems, we need to execute R code directly from Stata. In order to do this, you need to make sure to have install R in your computer and also the Stata command <code>rcall</code>. The do-file <code>02.LIS_organize_output.do</code> will check if you have it installed and will install it for you in case it is not. However, you can run the lines below to make sure everything is working fine. Also, you can take a look at the help file of <code>rcall</code> to get familiar with it.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cap which rcall</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="dt">_rc</span>) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    cap which github</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> (<span class="dt">_rc</span>) {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        net install github, from(<span class="st">"https://haghish.github.io/github/"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    github install haghish/rcall, stable</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="personal-drive" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="personal-drive">2. Personal Drive</h3>
<p>Make sure to add your UPI to the appropriate sections it appears by typing <code>disp lower("`c(username)'")</code> , following the example below,</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="fu">lower</span>(<span class="st">"`c(username)'"</span>) == <span class="st">"wbxxxxx"</span>) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span> <span class="ot">dir</span> <span class="st">"c:/Users/wbxxxxx/OneDrive - WBG/WorldBank/DECDG/PovcalNet Team/LIS_data"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="directives-of-the-code" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="directives-of-the-code">3. Directives of the code</h3>
<p>This do-file works like an ado-file in the sense that the output depends on the value of some local macros,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> update_surveynames = 1 <span class="co">// 1 to update survey names.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> <span class="kw">replace</span>            = 0 <span class="co">// 1 to replace data in memory even if it has not changed</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> p_drive_output_dir = 0 <span class="co">// 1 to use default Vintage_control folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If local <code>update_surveynames</code> is set to 1, the code will load the sheet <code>LIS_survname</code> from the the file <code>02.data/_aux/LIS datasets.xlsx</code> and updated the file <code>02.data/_aux/LIS_survname.dta</code>. If <code>replace</code> is set to 1, the code will replace any output with the same name. Otherwise, it will create a new vintage version <em>if the two files are different</em>. If they are not different, the code will do nothing. local <code>p_drive_output_dir</code> is deprecated, so you must leave it as <strong>0</strong>.</p>
</section>
<section id="pattern-of-the-text-files" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="pattern-of-the-text-files">4. Pattern of the text files</h3>
<p>When the text files with the information from LIS are stored in <code>00.LIS_output</code>, they should be stored in a systematic way so that they could be loaded and processed at the same time. This can be done by specifying in a matching regular expression in local <code>pattern</code>. For instance, all the files downloaded in December, 2020 could by loaded and processed using the directive, <code>local pattern = "LISSY_Dec2020.*txt"</code>.</p>
</section>
<section id="output" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="output">5. Output</h3>
<p>When the do-file is concluded, it saves the file <code>02.data/create_dta_status.dta</code> with the status of all the surveys processed.</p>
</section>
</section>
<section id="compare-new-lis-data-to-datalibweb-inventory" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="compare-new-lis-data-to-datalibweb-inventory"><span class="header-section-number">9.5</span> Compare new LIS data to Datalibweb inventory</h2>
<p>To identify what data is new and what data has changed with respect to the one available in datalibweb, you need to execute do-file <code>03.LIS_compare_dlw.do</code>. Again, this do-file is intended to be executed in one run, but you can do it in parts taking advantage of the different frames. At the end of the execution the file <code>02.data/comparison_results.dta</code> is created. This file contains three important variables <code>wf</code>, <code>wt</code>, and <code>gn</code>, which correspond to the ration of welfare means, weight means, and Gini coefficient between the data in datalibweb and the data in the folder, <code>p:/01.PovcalNet/03.QA/06.LIS/03.Vintage_control</code>.</p>
<p>You should only send to the Poverty GP those surveys for which at least one of these three variables is different to 1.</p>
</section>
<section id="the-excel-file-lis-datasets.xlsx" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="the-excel-file-lis-datasets.xlsx"><span class="header-section-number">9.6</span> The Excel file <code>LIS datasets.xlsx</code></h2>
<p>With each LIS data update performed, we must first identify from LIS the new surveys (countries and/or years) they had recently added. LIS send users e-mails informing about new datasets added, and also releases <a href="https://www.lisdatacenter.org/news-and-events/highlights/">newsletters</a> with this information.</p>
<p>Inside the <em>02.data</em> folder of your LIS_data GIT repository you will find a <em>_aux</em> sub folder, and the <code>LIS datasets.xlsx</code> file placed in there. We must <strong>manually</strong> update the tab <strong>LIS_survname tab</strong> adding new rows to the sheet. All necessary information to fill up this metadata (household size, currency, etc.) can be found in <a href="http://www.lisdatacenter.org/frontend#/home">METIS</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>ACRONYMS:</strong> The column survey_acronym is created by us. If you come across a new survey for which an acronym has not been previously established, the rules applied in the past by the team were the following:</p>
<ul>
<li><p>Acronyms are created based on the ENGLISH name of the survey. (Ex: <em>German Transfer Survey (Germany)</em> is “GTS”, followed by the suffix -LIS; thus GTS-LIS.</p></li>
<li><p>For the surveys that were Microcensus, we created the acronym “MC”, and for Denmark’s Law Model, “LM”.</p></li>
<li><p>All acronyms are created in capital letters.</p></li>
</ul>
</div>
</div>
<p>Finally, while the survey names in METIS are in English, some of the acronyms in parenthesis are still in the original language. In those cases we translated them to English. For instance, the survey name “<em>Household Budget Survey (BdF) (France)</em>” from METIS was changed to “<em>Household Budget Survey (<strong>HBS</strong>) (France)</em>” in the column <strong>surveyname</strong> of the excel.</p>
</section>
<section id="prepare-data-for-the-poverty-gp" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="prepare-data-for-the-poverty-gp"><span class="header-section-number">9.7</span> Prepare data for the Poverty GP</h2>
<p>Finally, the do-file <code>04.Append_new_LIS_bases.do</code> prepares the data to be shared with the Poverty GP. Note that this do-file ONLY appends the 400 bins data of surveys that are <strong>new</strong> and those where <strong>welfare changed</strong>, which are identified in the previous step <code>/comparison_results.dta</code> as those <code>gn != 1</code>.</p>
<p>Before running the code, make sure to <strong>change the output file name</strong> to the <strong>date</strong> of your update (last one saved was “LIS_bins_Dec_21_2020.dta”). The output is saved in <code>P:\01.PovcalNet\03.QA\06.LIS\04.Share_with_GP.</code></p>
<p>Finally, quickly prepare a short .dta file importing the metadata already created in the LIS_survname tab from the Excel, keeping ONLY the surveys of the append output you just run and send both files to Minh Cong Nguyen from the Poverty GP.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./PRIMUS.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">PRIMUS</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./welfare_data.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Welfare data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>